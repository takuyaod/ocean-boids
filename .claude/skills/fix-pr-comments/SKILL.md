---
description: Use when the user wants to fix, address, or resolve review comments on a pull request. Examples: "PR のレビュー指摘を修正して", "PR #5 のコメントを直して", "レビュー指摘に対応して", "PR レビューの修正をして".
---

# PR 指摘修正スキル

GitHub PR のレビューコメントを取得し、指摘事項を順番に修正します。

## 使い方

```
/fix-pr-comments <PR番号>
```

## 手順

1. `$ARGUMENTS` から PR 番号を取得する
2. `gh` CLI で PR のレビューコメントを取得する
3. 指摘事項を TodoWrite ツールでリスト化する
4. 各指摘を順番に修正する
5. 修正完了後にビルド・Lint を確認する

## 実行

### PR 番号の確認

`$ARGUMENTS` が空の場合は、PR 番号をユーザーに尋ねてください。

### 事前確認

`gh` CLI のインストールと認証状態を確認してください。

```bash
gh auth status
```

エラーが返った場合は、`gh auth login` での認証を促して中断してください。

### PR 情報とコメントの取得

PR の基本情報を取得します。

```bash
gh pr view <PR番号> --json number,title,author,baseRefName,headRefName,state
```

`state` が `MERGED` または `CLOSED` の場合は、以下のメッセージを表示してユーザーに続行するか確認してください。

```
⚠️ この PR はすでに <MERGED/CLOSED> です。続行しますか？ [y/N]
```

続いて、インラインレビューコメント（ファイル・行指定のコメント）を取得します。

```bash
gh api repos/{owner}/{repo}/pulls/<PR番号>/comments \
  --jq '[.[] | {id, path, line, body, user: .user.login, diff_hunk}]'
```

`{owner}` と `{repo}` は `gh repo view --json owner,name` で取得してください。

さらに、PR レビュー全体のコメント（サマリーコメント）を取得します。

```bash
gh api repos/{owner}/{repo}/pulls/<PR番号>/reviews \
  --jq '[.[] | select(.state == "CHANGES_REQUESTED" or .state == "COMMENTED") | {id, state, body, user: .user.login}]'
```

最後に、PR 一般コメント（会話コメント）を取得します。

```bash
gh pr view <PR番号> --json comments --jq '.comments[] | {author: .author.login, body}'
```

### コメントの整理と分類

取得したコメントを以下のように分類して表示してください。

```
## PR #<番号> 「<タイトル>」の指摘事項

### インラインコメント（<件数>件）
1. [<ファイルパス>:<行番号>] @<作者>: <コメント概要>
2. ...

### レビューコメント（<件数>件）
1. @<作者>（<状態>）: <コメント概要>
2. ...

### 一般コメント（<件数>件）
1. @<作者>: <コメント概要>
2. ...
```

コメントが0件の場合は以下を表示して終了してください。

```
✅ 指摘事項はありません。
```

### 修正方針の確認

ユーザーに修正方針を確認してください。

```
上記の指摘事項を修正します。
- すべて修正する
- 選択して修正する（番号で指定）

どうしますか？
```

「選択して修正する」場合は、修正する指摘番号をユーザーに指定してもらってください。

### TodoWrite で修正リストを作成

対象の指摘事項を TodoWrite ツールでリスト化します。各 Todo の内容は「<ファイル名> - <指摘の概要>」形式にしてください。

### 指摘の修正

各指摘に対して以下の手順で修正してください。

#### インラインコメントの修正

1. 該当ファイルを Read ツールで読み込む
2. `diff_hunk` と `line` から修正箇所を特定する
3. コメントの内容に従って Edit ツールで修正する
4. 修正内容をユーザーに簡潔に説明する

#### レビューコメント・一般コメントの修正

1. コメントの内容から修正が必要なファイルを特定する（必要に応じてコードベースを Grep/Glob で検索する）
2. 該当ファイルを Read ツールで読み込む
3. コメントの内容に従って Edit ツールで修正する
4. 修正内容をユーザーに簡潔に説明する

#### 判断が必要な場合

以下のケースでは修正を止めてユーザーに確認してください。

- コメントが「修正不要」「設計上の判断」等、コード変更を伴わない可能性がある場合
- 修正方法が複数考えられ、どちらが適切か判断できない場合
- コメントの意図が不明確な場合

```
❓ [<ファイル名>] の指摘について確認が必要です。
指摘: <コメント内容>
質問: <確認したい内容>
```

### ビルド・Lint の確認

すべての修正が完了したら、以下を `app/` ディレクトリで実行してください。

```bash
cd app && npm run lint
```

エラーがある場合は修正してください。

### 完了報告

```
## 修正完了

### 対応した指摘（<件数>件）
- ✅ [<ファイル名>] <指摘の概要> → <修正内容の概要>
- ...

### スキップした指摘（<件数>件）
- ⏭️ <指摘の概要> → <スキップ理由>

Lint: ✅ エラーなし
```
